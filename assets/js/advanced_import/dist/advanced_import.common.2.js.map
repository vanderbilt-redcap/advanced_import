{"version":3,"file":"advanced_import.common.2.js","mappings":";;;;;;;;;;;;;AAAA,IAAIA,MAAM,GAAG,SAASA,MAAM,GAAE;EAAC,IAAIC,GAAG,GAAC,IAAI;IAACC,EAAE,GAACD,GAAG,CAACE,KAAK,CAACD,EAAE;EAAC,OAAOA,EAAE,CAAC,KAAK,EAAC,CAAED,GAAG,CAACG,UAAU,GAAEF,EAAE,CAAC,KAAK,EAAC,CAACA,EAAE,CAAC,YAAY,EAAC;IAACG,KAAK,EAAC;MAAC,KAAK,EAACJ,GAAG,CAACK,GAAG;MAAC,eAAe,EAAC,EAAE;MAAC,UAAU,EAAC,KAAK;MAAC,SAAS,EAAC,SAAS;MAAC,MAAM,EAAC;IAAI;EAAC,CAAC,EAAC,CAACJ,EAAE,CAAC,gBAAgB,EAAC;IAACG,KAAK,EAAC;MAAC,OAAO,EAACJ,GAAG,CAACM,QAAQ;MAAC,OAAO,EAAE,GAAE,CAACN,GAAG,CAACM,QAAQ,GAAC,GAAG,EAAEC,OAAO,CAAC,CAAC,CAAE;IAAE;EAAC,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC,EAACN,EAAE,CAAC,KAAK,EAAC;IAACO,WAAW,EAAC;EAAkB,CAAC,EAAC,CAAER,GAAG,CAACS,cAAc,IAAIT,GAAG,CAACS,cAAc,GAAC,CAAC,GAAER,EAAE,CAAC,MAAM,EAAC,CAACD,GAAG,CAACU,EAAE,CAAC,WAAW,GAACV,GAAG,CAACW,EAAE,CAACX,GAAG,CAACY,WAAW,CAACZ,GAAG,CAACS,cAAc,CAAC,CAAC,GAAC,MAAM,GAACT,GAAG,CAACW,EAAE,CAACX,GAAG,CAACY,WAAW,CAACZ,GAAG,CAACa,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,GAACb,GAAG,CAACc,EAAE,EAAE,EAACb,EAAE,CAAC,iBAAiB,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC,GAACD,GAAG,CAACc,EAAE,EAAE,EAAE,MAAK,GAAEb,CAA8L,GAACD,GAAG,CAACc,EAAE,EAAE,CAAC,CAAC;AAC7wB,CAAC;AACD,IAAIG,eAAe,GAAG,EAAE;;;;;;;ACqBxB;AACA;AACA;AAEA;AACA;AACA;AAEA;EAEAC;IAAAL;IAAAM;IAAAC;IAAAd;IAAAe;IAAAZ;IAAAa;EAAA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;EACA;AACA;AAEA,yEAAe;EACfC;IACA;MACAC;MAAA;MACAC;MACAC;MACAC;MACAtB;MACAF;MACAyB;MACAC;MACAd;MAAA;MACAT;MACAG;MACAI;MACAD,WAAAA,EAAAA,2BAAAA;IACA;EACA;EACAkB;IACAC;MACAC;MACAC;IACA;EACA;EACAC;IACA;AACA;AACA;IACAC;MACA;MACA;MACA,iDACA;MACA,kDACA;IACA;IACAC;MACA;IACA;IACApB;MACA;MACA;MACA;MACA;MACA;IACA;EACA;EACAqB;IACA;EACA;EACAC;IACA;MACA;QACA;QACA;QACA;UAAAf;QAAA;QACA;QACA;QACA;QACA;UAAAY;UAAAI;QAAA;QACA;QACA;QAEA;UACA;QACA,OACA;UACA;UACA;UACA;UACA;QACA;MACA;QACA;UAAAC;QAAA;QACA;UAAAjB;QAAA;QACA;UAAAkB;QAAA;QACA;QACA;UAAAA;UAAAN;UAAAO;QAAA;QACA;MACA;IAEA;IACAC;MACA;QACA;QACA;QACA;QACA;MACA;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;QAAAC;MAAA;MACA;MACA;MACA;MACA;IACA;IACAC;MAAAlC;MAAAP;MAAAe;MAAAZ;IAAA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACAuC;MACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MACAC;QACA;QACA;QACA;QACA;QACA;QACA;MACA;IACA;EACA;AACA,CAAC;;AC3L8V,CAAC,oFAAe,oCAAG,EAAC;;;;ACAxR;AAC3B;AACL;;;AAG3D;AACA,CAAiI;AACjI,gBAAgB,sCAAU;AAC1B,EAAE,+CAAM;AACR,EAAE,MAAM;AACR,EAAE,eAAe;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA,iDAAe;;;;;;;;;;;;;;;;AClBf,IAAIpD,MAAM,GAAG,SAASA,MAAM,GAAE;EAAC,IAAIC,GAAG,GAAC,IAAI;IAACC,EAAE,GAACD,GAAG,CAACE,KAAK,CAACD,EAAE;EAAC,OAAOA,EAAE,CAAC,KAAK,EAAC,CAACA,EAAE,CAAC,cAAc,EAAC;IAACmD,GAAG,EAAC,UAAU;IAAChD,KAAK,EAAC;MAAC,OAAO,EAACJ,GAAG,CAAC+B;IAAK;EAAC,CAAC,CAAC,EAAC9B,EAAE,CAAC,aAAa,EAAC;IAACmD,GAAG,EAAC,MAAM;IAAChD,KAAK,EAAC;MAAC,IAAI,EAAC,MAAM;MAAC,gBAAgB,EAAC,gBAAgB;MAAC,aAAa,EAAC,kCAAkC;MAAC,kBAAkB,EAAC;IAAmB,CAAC;IAACiD,KAAK,EAAC;MAACC,KAAK,EAAEtD,GAAG,CAAC+B,KAAM;MAACwB,QAAQ,EAAC,UAAUC,GAAG,EAAE;QAACxD,GAAG,CAAC+B,KAAK,GAACyB,GAAG;MAAA,CAAC;MAACC,UAAU,EAAC;IAAO;EAAC,CAAC,CAAC,EAACxD,EAAE,CAAC,UAAU,EAAC;IAACyD,EAAE,EAAC;MAAC,OAAO,EAAC1D,GAAG,CAAC2D;IAAM;EAAC,CAAC,EAAC,CAAC3D,GAAG,CAACU,EAAE,CAAC,QAAQ,CAAC,CAAC,CAAC,EAACT,EAAE,CAAC,KAAK,EAAC;IAACO,WAAW,EAAC;EAA2D,CAAC,EAAC,CAACP,EAAE,CAAC,QAAQ,EAAC;IAACG,KAAK,EAAC;MAAC,OAAO,EAAC,gBAAgB;MAAC,SAAS,EAACJ,GAAG,CAAC4D;IAAG,CAAC;IAACC,WAAW,EAAC7D,GAAG,CAAC8D,EAAE,CAAC,CAAC;MAACC,GAAG,EAAC,QAAQ;MAACC,EAAE,EAAC,YAAU;QAAC,OAAO,CAAC/D,EAAE,CAAC,IAAI,EAAC;UAACO,WAAW,EAAC;QAAM,CAAC,EAAC,CAACR,GAAG,CAACU,EAAE,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;MAAA,CAAC;MAACuD,KAAK,EAAC;IAAI,CAAC,EAAC;MAACF,GAAG,EAAC,QAAQ;MAACC,EAAE,EAAC,YAAU;QAAC,OAAO,CAAC/D,EAAE,CAAC,IAAI,EAAC;UAACO,WAAW,EAAC;QAAM,CAAC,EAAC,CAACR,GAAG,CAACU,EAAE,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;MAAA,CAAC;MAACuD,KAAK,EAAC;IAAI,CAAC,CAAC;EAAC,CAAC,EAAC,CAAChE,EAAE,CAAC,aAAa,EAAC,CAACD,GAAG,CAACU,EAAE,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC;AAC/3B,CAAC;AACD,IAAIO,eAAe,GAAG,EAAE;;;;;;;ACmCxB;AACA;AAEA,iEAAe;EACfiD;IAAAC,YAAAA,EAAAA,2BAAAA;EAAA;EACA5C;IACA;MACAqC,GAAAA,EAAAA,0BAAAA;MACA7B;MACAzB;MACAD;MACA+D;MACAC;IACA;EACA;EACAnC;EACAI;IACAgC;MACAC;IACA;IACAZ;MACA;MACAa;QACAD;MACA;MACAC;QAAA/B;QAAAN;QAAAO;MAAA;QACA6B;UAAA9B;UAAAN;UAAAO;QAAA;MACA;MACA;IACA;EACA;AACA,CAAC;;ACpEsV,CAAC,uEAAe,4BAAG,EAAC;;;;ACAxR;AAC3B;AACL;;;AAGnD;AACA,CAAiI;AACjI,gBAAgB,sCAAU;AAC1B,EAAE,kCAAM;AACR,EAAE,MAAM;AACR,EAAE,eAAe;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA,yCAAe","sources":["webpack://advanced_import/./src/components/FileUploader.vue","webpack://advanced_import/src/components/FileUploader.vue","webpack://advanced_import/./src/components/FileUploader.vue?f20f","webpack://advanced_import/./src/components/FileUploader.vue?8077","webpack://advanced_import/./src/pages/Test.vue","webpack://advanced_import/src/pages/Test.vue","webpack://advanced_import/./src/pages/Test.vue?47ad","webpack://advanced_import/./src/pages/Test.vue?38a3"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[(_vm.processing)?_c('div',[_c('b-progress',{attrs:{\"max\":_vm.max,\"show-progress\":\"\",\"animated\":false,\"variant\":\"primary\",\"size\":\"sm\"}},[_c('b-progress-bar',{attrs:{\"value\":_vm.progress,\"label\":`${(_vm.progress*100).toFixed(2)}%`}})],1),_c('div',{staticClass:\"text-muted small\"},[(_vm.uploaded_bytes && _vm.uploaded_bytes>0)?_c('span',[_vm._v(\"uploaded \"+_vm._s(_vm.formatBytes(_vm.uploaded_bytes))+\" of \"+_vm._s(_vm.formatBytes(_vm.file_size)))]):_vm._e(),_c('non-blank-space')],1)],1):_vm._e(),(false)?_c('section',{staticClass:\"debug\"},[_vm._v(\" \"+_vm._s(_vm.progress)+\" \"+_vm._s(_vm.uploaded_bytes)+\" \"+_vm._s(_vm.remote_file_name)+\" \"+_vm._s(_vm.file_size)+\" \"+_vm._s(_vm.processed)+\" \")]):_vm._e()])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <div>\n        <div v-if=\"processing\">\n            <b-progress  :max=\"max\" show-progress :animated=\"false\" variant=\"primary\"  size=\"sm\">\n                <b-progress-bar :value=\"progress\" :label=\"`${(progress*100).toFixed(2)}%`\"></b-progress-bar>\n            </b-progress>\n            <!-- <button class=\"btn btn-danger\" @click=\"onPause\">Pause</button> -->\n            <div class=\"text-muted small\">\n                <span v-if=\"uploaded_bytes && uploaded_bytes>0\">uploaded {{formatBytes(uploaded_bytes)}} of {{formatBytes(file_size)}}</span>\n                <non-blank-space />\n            </div>\n        </div>\n        <section class=\"debug\" v-if=\"false\">\n            {{progress}}\n            {{uploaded_bytes}}\n            {{remote_file_name}}\n            {{file_size}}\n            {{processed}}\n        </section>\n    </div>\n</template>\n\n<script>\n// import { mapState } from 'vuex'\nimport FileReaderAsync from '@/libs/FileReaderAsync'\nimport {formatBytes} from '@/libs/Utility'\n\nconst MIN_CHUNK_SIZE = 1000 * 1024\nconst MAX_CHUNK_SIZE = 1000 * 1024 * 5\nconst TOTAL_CHUNKS = 20\n\nclass UploadMetadata {\n\n    constructor({file_size, name, percentage, progress, unique_name, uploaded_bytes, written_bytes}) {\n        this.file_size = file_size\n        this.name = name\n        this.percentage = percentage\n        this.progress = progress\n        this.unique_name = unique_name\n        this.uploaded_bytes = uploaded_bytes\n        this.written_bytes = written_bytes\n    }\n}\n\nexport default {\n    data() {\n        return {\n            cancel: null, // placeholder for canceling the promsie\n            content: '',\n            start: 0,\n            end: 0,\n            max:1,\n            processing: false,\n            paused: false,\n            abort: false,\n            remote_file_name: null, // unique file name used to save the file on the server\n            progress: 0,\n            uploaded_bytes:0,\n            file_size: 0,\n            formatBytes,\n        }\n    },\n    props: {\n        files: {\n            type: [File,Array],\n            default: () => []\n        }\n    },\n    computed: {\n        /* ...mapState({\n            file: state => state.import_settings.files,\n        }), */\n        file() {\n            let files = this.files\n            let file\n            if(typeof files==='object') file = files\n            else if(Array.isArray(files) && files.length>0) file = files[0]\n            if(file) return new File([file], file.name)\n            else return null\n        },\n        chunk_size() {\n            return this.calcChunkSize(this.file)\n        },\n        processed() {\n            let uploaded_bytes = this.uploaded_bytes || 0\n            let file_size = this.file_size || 0\n            let formatted_uploaded_bytes =  formatBytes(uploaded_bytes)\n            let formatted_file_size =  formatBytes(file_size)\n            return `${formatted_uploaded_bytes}/${formatted_file_size}`\n        }\n    },\n    destroyed() {\n        this.stop()\n    },\n    methods: {\n        async processChunk(file, chunk) {\n            try {\n                if(this.abort) return\n                const response = await this.sendChunk(file, chunk)\n                const {data} = response\n                if(!data) throw new Error('no response') //exit if no response data\n                const metadata = new UploadMetadata(data)\n                this.updateMetadata(metadata)\n                this.$emit('progress', {file, metadata}) // notify advancement\n                // advance the start\n                this.start = this.end\n\n                if(!this.paused && (this.end < file.size)) {\n                    return this.upload()\n                }\n                else {\n                    // exit if we are done\n                    this.reset()\n                    this.$emit('completed', metadata) // notify completed\n                    return metadata\n                }\n            } catch (error) {\n                const {response={}} = error\n                const {data={}} = response\n                const {message=''} = data\n                // console.log(message, file, error)\n                this.$emit('error', {message, file, error}) // notify error\n                this.reset()\n            }\n\n        },\n        calculateProgress(file, position) {\n            try {\n                const value = position / file.size\n                if(position<0) return 0\n                if(position>file.size) return 1\n                return value\n            } catch (error) {\n                return 0\n            }\n        },\n        sendChunk(file, chunk) {\n            const promise = this.$API.dispatch('upload/upload',file, chunk)\n            this.cancel = promise.cancel\n            return promise\n        },\n        calcChunkSize(file) {\n            if(!file) return MIN_CHUNK_SIZE\n            const {size=0} = file\n            let chunk_size = size/TOTAL_CHUNKS\n            if(chunk_size<MIN_CHUNK_SIZE) return MIN_CHUNK_SIZE\n            if(chunk_size>MAX_CHUNK_SIZE) return MAX_CHUNK_SIZE\n            return chunk_size\n        },\n        updateMetadata({file_size, progress, unique_name, uploaded_bytes}) {\n            this.file.unique_name = unique_name\n            this.remote_file_name = unique_name\n            this.uploaded_bytes = uploaded_bytes\n            this.file_size = file_size\n            this.progress = progress\n            return progress\n        },\n        async upload() {\n            if(!this.file) return\n            const file = this.file\n            this.processing = true\n            this.paused = false\n            this.end = this.start + this.chunk_size + 1\n            const blob = file.slice( this.start, this.end )\n            const file_reader = new FileReaderAsync()\n            const chunk = await file_reader.readAsDataURLAsync(blob)\n            return this.processChunk(file, chunk)\n        },\n        stop() {\n            if(typeof this.cancel==='function') this.cancel()\n            this.abort = true\n        },\n        onPause() {\n            this.processing = false\n            this.paused = true\n        },\n        reset() {\n            setTimeout(()=>{\n                this.cancel = null\n                this.start = 0\n                this.end = 0\n                this.processing = false\n                this.paused = false\n                this.abort = false\n            },1000)\n        }\n    }\n}\n</script>\n\n<style>\n\n</style>","import mod from \"-!../../node_modules/@vue/cli-plugin-babel/node_modules/thread-loader/dist/cjs.js!../../node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./FileUploader.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/@vue/cli-plugin-babel/node_modules/thread-loader/dist/cjs.js!../../node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./FileUploader.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./FileUploader.vue?vue&type=template&id=786ceae4&\"\nimport script from \"./FileUploader.vue?vue&type=script&lang=js&\"\nexport * from \"./FileUploader.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('FileUploader',{ref:\"uploader\",attrs:{\"files\":_vm.files}}),_c('b-form-file',{ref:\"file\",attrs:{\"id\":\"file\",\"DISABLED-state\":\"Boolean(files)\",\"placeholder\":\"Choose a file or drop it here...\",\"drop-placeholder\":\"Drop file here...\"},model:{value:(_vm.files),callback:function ($$v) {_vm.files=$$v},expression:\"files\"}}),_c('b-button',{on:{\"click\":_vm.upload}},[_vm._v(\"upload\")]),_c('div',{staticClass:\"d-flex flex-row justify-content-center align-items-center\"},[_c('b-card',{attrs:{\"title\":\"This is a test\",\"img-src\":_vm.cat},scopedSlots:_vm._u([{key:\"header\",fn:function(){return [_c('h6',{staticClass:\"mb-0\"},[_vm._v(\"Header Slot\")])]},proxy:true},{key:\"footer\",fn:function(){return [_c('h6',{staticClass:\"mb-0\"},[_vm._v(\"Footer Slot\")])]},proxy:true}])},[_c('b-card-text',[_vm._v(\" This is a test \")])],1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <div>\n        <FileUploader ref=\"uploader\" :files=\"files\"/>\n              <b-form-file\n            id=\"file\"\n            v-model=\"files\"\n            ref=\"file\"\n            DISABLED-state=\"Boolean(files)\"\n            placeholder=\"Choose a file or drop it here...\"\n            drop-placeholder=\"Drop file here...\"\n            ></b-form-file>\n            <b-button @click=\"upload\">upload</b-button>\n        <div class=\"d-flex flex-row justify-content-center align-items-center\">\n            <b-card \n                title=\"This is a test\"\n                :img-src=\"cat\">\n            <template #header>\n                <h6 class=\"mb-0\">Header Slot</h6>\n            </template>\n                <b-card-text>\n                This is a test\n                </b-card-text>\n                <template #footer>\n                    <h6 class=\"mb-0\">Footer Slot</h6>\n                </template>\n            </b-card>\n        </div>\n        <!-- <div>\n            <input type=\"file\" ref=\"file\" @change=\"onFileChange\">\n            <button @click=\"upload\">upload</button>\n        </div>\n        <b-progress :value=\"progress\" :max=\"max\" show-progress animated v-if=\"uploading\"></b-progress>\n        <span v-else-if=\"completed\">Completed!</span> -->\n    </div>\n</template>\n\n<script>\nimport cat from \"@/assets/crying-cat.jpg\"\nimport FileUploader from '@/components/FileUploader'\n\nexport default {\n    components: {FileUploader},\n    data() {\n        return {\n            cat,\n            files: null,\n            progress: 0,\n            max: 100,\n            uploading: false,\n            completed: false,\n        }\n    },\n    computed: {},\n    methods: {\n        onUploadCompleted() {\n            console.log(arguments)\n        },\n        upload() {\n           const uploader = this.$refs.uploader\n            uploader.$on('completed', () => {\n                console.log(arguments)\n            })\n            uploader.$on('error', ({message, file, error})=> {\n                console.log({message, file, error})\n            })\n            return uploader.upload()\n        }\n    },\n}\n</script>\n\n<style scope>\n\n</style>","import mod from \"-!../../node_modules/@vue/cli-plugin-babel/node_modules/thread-loader/dist/cjs.js!../../node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Test.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/@vue/cli-plugin-babel/node_modules/thread-loader/dist/cjs.js!../../node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Test.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Test.vue?vue&type=template&id=7d9880e0&\"\nimport script from \"./Test.vue?vue&type=script&lang=js&\"\nexport * from \"./Test.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","_c","_self","processing","attrs","max","progress","toFixed","staticClass","uploaded_bytes","_v","_s","formatBytes","file_size","_e","remote_file_name","processed","staticRenderFns","constructor","name","percentage","unique_name","written_bytes","data","cancel","content","start","end","paused","abort","props","files","type","default","computed","file","chunk_size","destroyed","methods","metadata","response","message","error","calculateProgress","sendChunk","calcChunkSize","size","updateMetadata","stop","onPause","reset","setTimeout","ref","model","value","callback","$$v","expression","on","upload","cat","scopedSlots","_u","key","fn","proxy","components","FileUploader","uploading","completed","onUploadCompleted","console","uploader"],"sourceRoot":""}